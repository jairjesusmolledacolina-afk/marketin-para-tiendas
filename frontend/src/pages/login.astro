--- 
import Header from '../components/Header.astro';
const API = import.meta.env.VITE_API_URL || 'http://localhost:4000';
--- 
<html>
  <head>
    <meta charset=\"utf-8\" />
    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />
    <title>Login — TiendasCoro</title>
    <link rel=\"stylesheet\" href=\"/src/styles/global.css\" />
  </head>
  <body>
    <Header />
    <main class=\"container\">
      <h1 class=\"text-2xl font-bold mb-4\">Iniciar sesión</h1>
      <form id=\"form\" class=\"card max-w-md\">
        <label class=\"block mb-2\">
          <div>Email</div>
          <input name=\"email\" type=\"email\" class=\"w-full border rounded px-2 py-1\" required />
        </label>
        <label class=\"block mb-4\">
          <div>Password</div>
          <input name=\"password\" type=\"password\" class=\"w-full border rounded px-2 py-1\" required />
        </label>
        <button type=\"submit\" class=\"bg-indigo-600 text-white px-4 py-2 rounded\">Entrar</button>
        <div id=\"msg\" class=\"mt-2 text-sm\"></div>
      </form>
    </main>

    <script is:inline>
      (function () {
        const API = import.meta.env.VITE_API_URL || 'http://localhost:4000';
        const form = document.getElementById('form');
        const msg = document.getElementById('msg');

        form.addEventListener('submit', async (e) => {
          e.preventDefault();
          msg.textContent = '';
          const data = Object.fromEntries(new FormData(form));
          try {
            const res = await fetch(${API}/api/auth/login, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(data),
            });
            const j = await res.json();
            if (!res.ok) {
              msg.textContent = j.message || 'Credenciales inválidas';
              return;
            }
            localStorage.setItem('token', j.token);
            localStorage.setItem('user', JSON.stringify(j.user));
            msg.textContent = 'Logueado. Redirigiendo...';
            setTimeout(() => (location.href = '/'), 600);
          } catch (err) {
            console.error(err);
            msg.textContent = 'Error de red';
          }
        });
      })();
    </script>
  </body>
</html>
